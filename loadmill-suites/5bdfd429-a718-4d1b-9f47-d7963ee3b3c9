{
  "conf": {
    "meta": {
      "description": "API tests examples"
    },
    "loginFlow": [
      {
        "url": "${blog_url}/ghost/api/v0.1/authentication/token",
        "method": "POST",
        "headers": [
          {
            "Accept": "application/json, text/javascript, */*; q=0.01"
          },
          {
            "X-Requested-With": "XMLHttpRequest"
          },
          {
            "Accept-Language": "en-US,en;q=0.9,he;q=0.8,pt;q=0.7"
          }
        ],
        "assert": [],
        "extract": [
          {
            "access_token": {
              "jsonPath": "$[\"access_token\"]"
            }
          },
          {
            "token_type": {
              "jsonPath": "$[\"token_type\"]"
            }
          }
        ],
        "timeout": 25000,
        "expectedStatus": "SUCCESS",
        "description": "üóù Global login request - adds Authorization header to all following requests ",
        "postData": {
          "text": "grant_type=password&username=${username}&password=${password}&client_id=ghost-admin&client_secret=${client_secret}",
          "mimeType": "application/x-www-form-urlencoded"
        }
      }
    ],
    "useCookies": true,
    "parameters": [
      {
        "blog_url": "https://loadmill-test-blog.herokuapp.com"
      },
      {
        "username": "a@b.com"
      },
      {
        "password": "Test1234"
      },
      {
        "client_secret": "8c93bf1bb580"
      },
      {
        "p2_request_body_posts_0_title": "My test post ${__random_number}"
      }
    ],
    "authenticationHeaders": [
      {
        "Authorization": "${token_type} ${access_token}"
      }
    ],
    "sharedLoginFlowDescription": "New Load Test - Apr 19"
  },
  "flows": [
    {
      "order": 0,
      "conf": {
        "duration": 60000,
        "concurrency": 1,
        "requests": [
          {
            "url": "${blog_url}/ghost/signin/",
            "method": "GET",
            "headers": [
              {
                "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9"
              },
              {
                "Accept-Language": "en-US,en;q=0.9,he;q=0.8,pt;q=0.7"
              }
            ],
            "assert": [],
            "extract": [],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "üö™ Load login page "
          },
          {
            "url": "${blog_url}/ghost/api/v0.1/authentication/token",
            "method": "POST",
            "headers": [
              {
                "Accept": "application/json, text/javascript, */*; q=0.01"
              },
              {
                "X-Requested-With": "XMLHttpRequest"
              },
              {
                "Accept-Language": "en-US,en;q=0.9,he;q=0.8,pt;q=0.7"
              }
            ],
            "assert": [],
            "extract": [
              {
                "access_token": {
                  "jsonPath": "$[\"access_token\"]"
                }
              },
              {
                "token_type": {
                  "jsonPath": "$[\"token_type\"]"
                }
              }
            ],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "üîë Authentication request - extract token using JSONPath from the response ",
            "postData": {
              "text": "grant_type=password&username=${username}&password=${password}&client_id=ghost-admin&client_secret=${client_secret}",
              "mimeType": "application/x-www-form-urlencoded"
            }
          },
          {
            "url": "${blog_url}/ghost/api/v0.1/posts/?include=tags",
            "method": "POST",
            "headers": [
              {
                "Accept": "application/json, text/javascript, */*; q=0.01"
              },
              {
                "X-Requested-With": "XMLHttpRequest"
              },
              {
                "X-Ghost-Version": "0.11"
              },
              {
                "Authorization": "${token_type} ${access_token}"
              },
              {
                "Accept-Language": "en-US,en;q=0.9,he;q=0.8,pt;q=0.7"
              }
            ],
            "assert": [],
            "extract": [
              {
                "created_post_id": {
                  "jsonPath": "$[\"posts\"][0][\"id\"]"
                }
              }
            ],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "üìù Create new blog post - extract its id using JSONPath from the response",
            "postData": {
              "text": "{\"posts\":[{\"title\":\"${__escape_quotes(p2_request_body_posts_0_title)}\",\"slug\":\"my-test-post-123\",\"markdown\":\"\",\"image\":null,\"featured\":false,\"page\":false,\"status\":\"draft\",\"language\":\"en_US\",\"meta_title\":null,\"meta_description\":null,\"author\":\"1\",\"publishedBy\":null,\"tags\":[]}]}",
              "mimeType": "application/json; charset=UTF-8"
            }
          },
          {
            "url": "${blog_url}/ghost/api/v0.1/posts/${created_post_id}/?include=tags",
            "method": "PUT",
            "headers": [
              {
                "Host": "loadmill-test-blog.herokuapp.com"
              },
              {
                "Accept": "application/json, text/javascript, */*; q=0.01"
              },
              {
                "X-Requested-With": "XMLHttpRequest"
              },
              {
                "X-Ghost-Version": "0.11"
              },
              {
                "Authorization": "${token_type} ${access_token}"
              },
              {
                "Content-Type": "application/json; charset=UTF-8"
              },
              {
                "Accept-Language": "en-US,en;q=0.9,he;q=0.8,pt;q=0.7"
              }
            ],
            "assert": [],
            "extract": [],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "üéâ Publish the created blog post using its extracted id",
            "postData": {
              "text": "{\"posts\":[{\"id\":${created_post_id},\"title\":\"${p2_request_body_posts_0_title}\",\"slug\":\"my-test-post-123\",\"markdown\":\"A very interesting blog post content\",\"image\":null,\"featured\":false,\"page\":false,\"status\":\"published\",\"language\":\"en_US\",\"meta_title\":null,\"meta_description\":null,\"updated_at\":\"2020-03-01T13:49:41.000Z\",\"updated_by\":1,\"published_at\":null,\"created_at\":\"2020-03-01T13:49:29.000Z\",\"created_by\":1,\"author\":\"1\",\"publishedBy\":null,\"tags\":[]}]}",
              "mimeType": "application/json; charset=UTF-8"
            }
          }
        ],
        "meta": {
          "description": "üîë Login & create a blog post"
        },
        "parameterPools": [],
        "targetedCountries": [],
        "iterationDelay": 1000,
        "cachePenetration": {},
        "rampUp": 60000,
        "skipLoginFlow": true,
        "parameters": [
          {
            "blog_url": "https://loadmill-test-blog.herokuapp.com"
          },
          {
            "username": "a@b.com"
          },
          {
            "password": "Test1234"
          },
          {
            "client_secret": "8c93bf1bb580"
          },
          {
            "p2_request_body_posts_0_title": "My test post ${__random_number}"
          }
        ]
      },
      "runInCi": false
    },
    {
      "order": 1,
      "conf": {
        "duration": 60000,
        "concurrency": 1,
        "requests": [
          {
            "url": "${blog_url}/ghost/api/v0.1/posts/?include=tags",
            "method": "POST",
            "headers": [
              {
                "Accept": "application/json, text/javascript, */*; q=0.01"
              },
              {
                "X-Requested-With": "XMLHttpRequest"
              },
              {
                "X-Ghost-Version": "0.11"
              },
              {
                "Accept-Language": "en-US,en;q=0.9,he;q=0.8,pt;q=0.7"
              }
            ],
            "assert": [],
            "extract": [
              {
                "created_post_id": {
                  "jsonPath": "$[\"posts\"][0][\"id\"]"
                }
              }
            ],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "Create a new blog post (authenticated by global login section)",
            "postData": {
              "text": "{\"posts\":[{\"title\":\"${__escape_quotes(p2_request_body_posts_0_title)}\",\"slug\":\"my-test-post-123\",\"markdown\":\"\",\"image\":null,\"featured\":false,\"page\":false,\"status\":\"draft\",\"language\":\"en_US\",\"meta_title\":null,\"meta_description\":null,\"author\":\"1\",\"publishedBy\":null,\"tags\":[]}]}",
              "mimeType": "application/json; charset=UTF-8"
            }
          },
          {
            "url": "${blog_url}/ghost/api/v0.1/posts/${created_post_id}/?include=tags",
            "method": "PUT",
            "headers": [
              {
                "Host": "loadmill-test-blog.herokuapp.com"
              },
              {
                "Accept": "application/json, text/javascript, */*; q=0.01"
              },
              {
                "X-Requested-With": "XMLHttpRequest"
              },
              {
                "X-Ghost-Version": "0.11"
              },
              {
                "Content-Type": "application/json; charset=UTF-8"
              },
              {
                "Accept-Language": "en-US,en;q=0.9,he;q=0.8,pt;q=0.7"
              }
            ],
            "assert": [],
            "extract": [],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "Publish the created blog post (authenticated by global login section)",
            "postData": {
              "text": "{\"posts\":[{\"id\":${created_post_id},\"title\":\"${p2_request_body_posts_0_title}\",\"slug\":\"my-test-post-123\",\"markdown\":\"A very interesting blog post content\",\"image\":null,\"featured\":false,\"page\":false,\"status\":\"published\",\"language\":\"en_US\",\"meta_title\":null,\"meta_description\":null,\"updated_at\":\"2020-03-01T13:49:41.000Z\",\"updated_by\":1,\"published_at\":null,\"created_at\":\"2020-03-01T13:49:29.000Z\",\"created_by\":1,\"author\":\"1\",\"publishedBy\":null,\"tags\":[]}]}",
              "mimeType": "application/json; charset=UTF-8"
            }
          }
        ],
        "meta": {
          "description": "üóù Using global login flow"
        },
        "parameterPools": [],
        "targetedCountries": [],
        "iterationDelay": 1000,
        "cachePenetration": {},
        "rampUp": 60000,
        "skipLoginFlow": false,
        "parameters": [
          {
            "blog_url": "https://loadmill-test-blog.herokuapp.com"
          },
          {
            "username": "a@b.com"
          },
          {
            "password": "Test1234"
          },
          {
            "client_secret": "8c93bf1bb580"
          },
          {
            "p2_request_body_posts_0_title": "My test post ${__random_number}"
          }
        ]
      },
      "runInCi": false
    },
    {
      "order": 2,
      "conf": {
        "duration": 60000,
        "concurrency": 1,
        "requests": [
          {
            "url": "${blog_url}/ghost/api/v0.1/users/me/?include=roles&status=all",
            "method": "GET",
            "headers": [
              {
                "Host": "loadmill-test-blog.herokuapp.com"
              },
              {
                "Accept": "application/json, text/javascript, */*; q=0.01"
              },
              {
                "X-Requested-With": "XMLHttpRequest"
              },
              {
                "X-Ghost-Version": "0.11"
              },
              {
                "Authorization": "Bearer lfx7QirI9dt3UpShLHuqmI9JdaiNos8YfakAkWKLh25eEMSrvrJkyOTgyuW7djfAcSqr2aLYftkoy9bvAMuD1LBYGG53wp2uGUihPy1YIFKXYW5xgND3DBVUoOoxkA0J6DrUOr3E5r8gw3Azx0HLeHPGzqDGR1ppezVAuPKdVz0yGkbKDs7ptbcxuxklLDZ7sTNQQy23zwhsX7mwdZ7SrEFkvzJrAYBatzgBkZnEaxWpxIVSF8fhnoFGxz9TPC4"
              },
              {
                "Accept-Language": "en-US,en;q=0.9,he;q=0.8,pt;q=0.7"
              }
            ],
            "assert": [
              {
                "check": "user_name",
                "equals": "Jon Skeet"
              }
            ],
            "extract": [
              {
                "user_name": {
                  "jsonPath": "$.users[0].name"
                }
              }
            ],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "Extract user name and verify it is \"Jon Skeet\""
          }
        ],
        "meta": {
          "description": "üîç Extract using JSONPath"
        },
        "parameterPools": [],
        "targetedCountries": [],
        "iterationDelay": 1000,
        "cachePenetration": {},
        "rampUp": 60000,
        "skipLoginFlow": false,
        "parameters": [
          {
            "blog_url": "https://loadmill-test-blog.herokuapp.com"
          },
          {
            "username": "a@b.com"
          },
          {
            "password": "Test1234"
          },
          {
            "client_secret": "8c93bf1bb580"
          },
          {
            "p2_request_body_posts_0_title": "My test post ${__random_number}"
          }
        ]
      },
      "runInCi": false
    },
    {
      "order": 3,
      "conf": {
        "duration": 60000,
        "concurrency": 1,
        "requests": [
          {
            "url": "${blog_url}",
            "method": "GET",
            "headers": [],
            "assert": [
              {
                "check": "blog_title"
              },
              {
                "check": "blog_description",
                "contains": "stories and ideas"
              }
            ],
            "extract": [
              {
                "blog_title": {
                  "jQuery": {
                    "query": "title",
                    "attr": ""
                  }
                }
              },
              {
                "blog_description": {
                  "jQuery": {
                    "query": "meta[name=\"description\"]",
                    "attr": "content"
                  }
                }
              }
            ],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "Extract user blog title and description from HTML"
          }
        ],
        "meta": {
          "description": "üîé Extract using jQuery (XPath)"
        },
        "parameterPools": [],
        "targetedCountries": [],
        "iterationDelay": 1000,
        "cachePenetration": {},
        "rampUp": 60000,
        "skipLoginFlow": true,
        "parameters": [
          {
            "blog_url": "https://loadmill-test-blog.herokuapp.com"
          },
          {
            "username": "a@b.com"
          },
          {
            "password": "Test1234"
          },
          {
            "client_secret": "8c93bf1bb580"
          },
          {
            "p2_request_body_posts_0_title": "My test post ${__random_number}"
          }
        ]
      },
      "runInCi": false
    },
    {
      "order": 4,
      "conf": {
        "duration": 60000,
        "concurrency": 1,
        "requests": [
          {
            "url": "${blog_url}/ghost/signin/",
            "method": "GET",
            "headers": [],
            "assert": [
              {
                "check": "page_title"
              },
              {
                "check": "error_in_page",
                "falsy": true
              }
            ],
            "extract": [
              {
                "page_title": {
                  "regex": "<title>(.*?)<\\/title>"
                }
              },
              {
                "error_in_page": {
                  "regex": "error"
                }
              }
            ],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "Verify login page has title and that the word \"error\" does not appear"
          }
        ],
        "meta": {
          "description": "üîç Extract using RegExp"
        },
        "parameterPools": [],
        "targetedCountries": [],
        "iterationDelay": 1000,
        "cachePenetration": {},
        "rampUp": 60000,
        "skipLoginFlow": true,
        "parameters": [
          {
            "blog_url": "https://loadmill-test-blog.herokuapp.com"
          },
          {
            "username": "a@b.com"
          },
          {
            "password": "Test1234"
          },
          {
            "client_secret": "8c93bf1bb580"
          },
          {
            "p2_request_body_posts_0_title": "My test post ${__random_number}"
          }
        ]
      },
      "runInCi": false
    },
    {
      "order": 5,
      "conf": {
        "duration": 60000,
        "concurrency": 1,
        "requests": [
          {
            "url": "${blog_url}",
            "method": "GET",
            "headers": [],
            "assert": [],
            "extract": [],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "This test is toggled to run from external integrations ‚¨Ü run it from the CI tab on the left"
          }
        ],
        "meta": {
          "description": "ü§ñ Continuous integration test (CI)"
        },
        "parameterPools": [],
        "targetedCountries": [],
        "iterationDelay": 1000,
        "cachePenetration": {},
        "rampUp": 60000,
        "skipLoginFlow": true,
        "parameters": [
          {
            "blog_url": "https://loadmill-test-blog.herokuapp.com"
          },
          {
            "username": "a@b.com"
          },
          {
            "password": "Test1234"
          },
          {
            "client_secret": "8c93bf1bb580"
          },
          {
            "p2_request_body_posts_0_title": "My test post ${__random_number}"
          }
        ]
      },
      "runInCi": true
    },
    {
      "order": 6,
      "conf": {
        "duration": 60000,
        "concurrency": 1,
        "requests": [
          {
            "url": "${blog_url}/a-non-existing-blog-post/",
            "method": "GET",
            "headers": [],
            "assert": [
              {
                "check": "__status",
                "equals": "404"
              }
            ],
            "extract": [],
            "timeout": 25000,
            "expectedStatus": "ERROR",
            "description": "Request a non-existing page and expect an error response with 404 status"
          }
        ],
        "meta": {
          "description": "üö´ Negative test case (failed request)"
        },
        "parameterPools": [],
        "targetedCountries": [],
        "iterationDelay": 1000,
        "cachePenetration": {},
        "rampUp": 60000,
        "skipLoginFlow": true,
        "parameters": [
          {
            "blog_url": "https://loadmill-test-blog.herokuapp.com"
          },
          {
            "username": "a@b.com"
          },
          {
            "password": "Test1234"
          },
          {
            "client_secret": "8c93bf1bb580"
          },
          {
            "p2_request_body_posts_0_title": "My test post ${__random_number}"
          }
        ]
      },
      "runInCi": false
    },
    {
      "order": 7,
      "conf": {
        "duration": 60000,
        "concurrency": 1,
        "requests": [
          {
            "url": "google.com?${__random_letters('4')}",
            "method": "GET",
            "headers": [],
            "assert": [],
            "extract": [
              {
                "the_time": "${__now_iso()}"
              }
            ],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "Search google for a random 4-letter word "
          }
        ],
        "meta": {
          "description": "üí≤ Using built-in parameters"
        },
        "parameterPools": [],
        "targetedCountries": [],
        "iterationDelay": 1000,
        "cachePenetration": {},
        "rampUp": 60000,
        "skipLoginFlow": true,
        "parameters": [
          {
            "blog_url": "https://loadmill-test-blog.herokuapp.com"
          },
          {
            "username": "a@b.com"
          },
          {
            "password": "Test1234"
          },
          {
            "client_secret": "8c93bf1bb580"
          },
          {
            "p2_request_body_posts_0_title": "My test post ${__random_number}"
          }
        ]
      },
      "runInCi": false
    },
    {
      "order": 8,
      "conf": {
        "duration": 60000,
        "concurrency": 1,
        "requests": [
          {
            "url": "${blog_url}/ghost/api/v0.1/configuration/timezones/",
            "method": "GET",
            "headers": [
              {
                "Host": "loadmill-test-blog.herokuapp.com"
              },
              {
                "Accept": "application/json, text/javascript, */*; q=0.01"
              },
              {
                "X-Requested-With": "XMLHttpRequest"
              },
              {
                "X-Ghost-Version": "0.11"
              },
              {
                "Accept-Language": "en-US,en;q=0.9,he;q=0.8,pt;q=0.7"
              }
            ],
            "assert": [
              {
                "check": "hawaii_in_GMT",
                "contains": "(GMT -9:00)"
              }
            ],
            "extract": [
              {
                "hawaii_in_GMT": {
                  "jsonPath": "$..[?(@.name == 'Pacific/Honolulu')].label"
                }
              }
            ],
            "timeout": 25000,
            "expectedStatus": "SUCCESS",
            "description": "Extract Hawaii timezone by label and verify that it is GMT -10:00"
          }
        ],
        "meta": {
          "description": "üíî Broken test flow - Fix me!"
        },
        "parameterPools": [],
        "targetedCountries": [],
        "iterationDelay": 1000,
        "cachePenetration": {},
        "rampUp": 60000,
        "skipLoginFlow": true,
        "parameters": [
          {
            "blog_url": "https://loadmill-test-blog.herokuapp.com"
          },
          {
            "username": "a@b.com"
          },
          {
            "password": "Test1234"
          },
          {
            "client_secret": "8c93bf1bb580"
          },
          {
            "p2_request_body_posts_0_title": "My test post ${__random_number}"
          }
        ]
      },
      "runInCi": false
    }
  ]
}